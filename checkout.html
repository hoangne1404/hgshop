<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Thanh to√°n - HgShop</title>
  <link rel="stylesheet" href="style.css" />
  
  <!-- Firebase -->
  <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
      import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
      import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

      // Import Firebase config
      import "./firebase-config.js";

      // Initialize Firebase
      const app = initializeApp(window.firebaseConfig);
      const auth = getAuth(app);
      const database = getDatabase(app);

      // Make Firebase objects globally available
      window.firebaseApp = app;
      window.firebaseAuth = auth;
      window.firebaseDatabase = database;

      // Authentication state listener
      onAuthStateChanged(auth, (user) => {
          if (user) {
              // Load user data
              const userRef = ref(database, 'users/' + user.uid);
              onValue(userRef, (snapshot) => {
                  const userData = snapshot.val();
                  if (userData) {
                      // Save user data to localStorage
                      localStorage.setItem('currentUser', JSON.stringify({
                          uid: user.uid,
                          email: user.email,
                          ...userData
                      }));
                  }
              });
          } else {
              // Redirect to login if not authenticated
              window.location.href = 'login.html';
          }
      });
  </script>
  
  <script defer src="auth.js"></script>
  <script defer src="checkout.js"></script>
  <script defer src="cart.js"></script>
</head>
<body>
  <!-- header same as index (auth.js will apply logo/avatar) -->
  <header class="topbar">
    <div class="brand">
      <a href="index.html" style="display: flex; align-items: center; gap: 12px; text-decoration: none; color: inherit;">
        <div class="logo-text-wrap">
          <div class="logo-text">
  <span class="logo-h">H</span><span class="logo-g">g</span><span class="logo-shop">Shop</span>
</div>
          <div class="logo-sub">Linh ki·ªán & Laptop</div>
        </div>
      </a>
    </div>
    <a href="index.html" class="link white">‚Üê Quay l·∫°i mua s·∫Øm</a>
  </header>

  <main class="container narrow">
    <h2>Thanh to√°n</h2>
    
    <div class="card">
      <h3>ƒê∆°n h√†ng c·ªßa b·∫°n</h3>
      <div id="orderSummary"></div>
    </div>

    <div class="card">
      <h3>Th√¥ng tin giao h√†ng</h3>
      <div class="form-group">
        <label for="fullname">H·ªç v√† t√™n</label>
        <input id="fullname" class="form-control" placeholder="Nh·∫≠p h·ªç v√† t√™n" />
      </div>
      
      <div class="form-group">
        <label for="phone">S·ªë ƒëi·ªán tho·∫°i</label>
        <input id="phone" class="form-control" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i" />
      </div>
      
      <div class="form-group">
        <label for="address">ƒê·ªãa ch·ªâ chi ti·∫øt</label>
        <textarea id="address" class="form-control" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ chi ti·∫øt" rows="3"></textarea>
      </div>
      
      <div style="margin:16px 0">
        <button id="locateBtn" class="btn secondary">X√°c nh·∫≠n v·ªã tr√≠ hi·ªán t·∫°i</button>
      </div>
      
      <div id="mapWrap" class="map-wrap hidden"></div>
    </div>

    <div class="card">
      <h3>Ph∆∞∆°ng th·ª©c thanh to√°n</h3>
      <div class="payment-methods">
        <label class="payment-option">
          <input type="radio" name="pay" value="cod" checked /> 
          <div class="payment-content">
            <div class="payment-icon">üí≥</div>
            <div>
              <div class="payment-title">Thanh to√°n khi nh·∫≠n</div>
              <div class="payment-desc">Tr·∫£ ti·ªÅn khi nh·∫≠n h√†ng</div>
            </div>
          </div>
        </label>
        
        <label class="payment-option">
          <input type="radio" name="pay" value="qr" /> 
          <div class="payment-content">
            <div class="payment-icon">üì±</div>
            <div>
              <div class="payment-title">Chuy·ªÉn kho·∫£n (QR)</div>
              <div class="payment-desc">Qu√©t m√£ QR ƒë·ªÉ thanh to√°n</div>
            </div>
          </div>
        </label>
      </div>

      <div id="qrBox" class="qr-box hidden">
        <p>Qu√©t m√£ QR ƒë·ªÉ chuy·ªÉn kho·∫£n:</p>
        <img src="images/qr.jpg" alt="qr" class="qr-img"/>
      </div>
    </div>

    <div style="margin-top:24px;text-align:center">
      <button id="placeOrder" class="btn primary" style="padding:14px 28px;font-size:18px">
        X√°c nh·∫≠n & ƒê·∫∑t h√†ng
      </button>
    </div>
  </main>

  <footer class="footer">
    <div>¬© 2025 HgShop</div>
    <div>nguyennhathoangne@gmail.com | 0353867095</div>
  </footer>
</body>
</html>