<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tr·ªü th√†nh ng∆∞·ªùi b√°n - HgShop</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-storage.js";

        // Import Firebase config
        import "./firebase-config.js";

        // Initialize Firebase
        const app = initializeApp(window.firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);
        const storage = getStorage(app);

        // Make Firebase objects globally available
        window.firebaseApp = app;
        window.firebaseAuth = auth;
        window.firebaseDatabase = database;
        window.firebaseStorage = storage;

        // Authentication state listener
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Load user data
                const userRef = ref(database, 'users/' + user.uid);
                onValue(userRef, (snapshot) => {
                    const userData = snapshot.val();
                    if (userData) {
                        // Save user data to localStorage
                        localStorage.setItem('currentUser', JSON.stringify({
                            uid: user.uid,
                            email: user.email,
                            ...userData
                        }));
                    }
                });
            } else {
                // Redirect to login if not authenticated
                window.location.href = 'login.html';
            }
        });
    </script>
    
    <script defer src="auth.js"></script>
    <script defer src="cloudinary-config.js"></script>
    <script defer src="cloudinary.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="navbar">
        <div class="logo">
            <a href="index.html" style="color: white; text-decoration: none;">HgShop</a>
        </div>
        
        <nav class="nav-links">
            <a href="index.html">Trang ch·ªß</a>
            <a href="products.html">S·∫£n ph·∫©m</a>
            <a href="contact.html">Li√™n h·ªá</a>
            <a href="#" class="cart">Gi·ªè h√†ng üõí</a>
        </nav>
        
        <div class="topbar-icons">
            <button id="notifyBtn" class="icon-btn">
                <span class="material-icons">notifications</span>
                <span id="notificationBadge" class="badge">0</span>
            </button>
            
            <button id="cartBtn" class="icon-btn">
                <span class="material-icons cart-icon">shopping_cart</span>
                <span id="cartCount" class="badge">0</span>
            </button>
            
            <div class="avatar-wrapper">
                <img id="avatarIcon" src="images/default-avatar.png" alt="Avatar" class="avatar-icon">
            </div>
        </div>
    </header>

    <!-- Notification Tooltip -->
    <div id="notifyTooltip" class="tooltip hidden">
        <div class="tooltip-header">
            <h3>Th√¥ng b√°o</h3>
            <button id="closeNotify" class="close-btn">
                <span class="material-icons">close</span>
            </button>
        </div>
        <div id="notificationList" class="notification-list">
            <p>Kh√¥ng c√≥ th√¥ng b√°o m·ªõi</p>
        </div>
    </div>
    
    <!-- Account Menu -->
    <div id="accountMenu" class="account-menu hidden">
        <a href="profile.html" class="menu-item">
            <span class="material-icons">person</span>
            T√†i kho·∫£n c·ªßa t√¥i
        </a>
        <a href="orders.html" class="menu-item">
            <span class="material-icons">receipt</span>
            ƒê∆°n h√†ng c·ªßa b·∫°n
        </a>
        <a id="becomeSellerLink" href="become-seller.html" class="menu-item active">
            <span class="material-icons">store</span>
            <span id="sellerMenuText">Tr·ªü th√†nh ng∆∞·ªùi b√°n</span>
        </a>
        <hr>
        <button id="logoutBtn" class="menu-item logout">
            <span class="material-icons">logout</span>
            <span>ƒêƒÉng xu·∫•t</span>
        </button>
    </div>
    
    <main>
        <section class="become-seller-page">
            <div class="container">
                <h1>Tr·ªü th√†nh ng∆∞·ªùi b√°n h√†ng</h1>
                
                <div class="become-seller-content">
                    <div class="benefits-section">
                        <h2>L·ª£i √≠ch khi b√°n h√†ng tr√™n HgShop</h2>
                        <div class="benefits-grid">
                            <div class="benefit-card">
                                <span class="material-icons">people</span>
                                <h3>Ti·∫øp c·∫≠n kh√°ch h√†ng</h3>
                                <p>ƒê·∫°t ƒë∆∞·ª£c h√†ng ng√†n kh√°ch h√†ng ti·ªÅm nƒÉng m·ªói th√°ng</p>
                            </div>
                            <div class="benefit-card">
                                <span class="material-icons">local_shipping</span>
                                <h3>Qu·∫£n l√Ω ƒë∆°n h√†ng</h3>
                                <p>H·ªá th·ªëng qu·∫£n l√Ω ƒë∆°n h√†ng ti·ªán l·ª£i v√† d·ªÖ s·ª≠ d·ª•ng</p>
                            </div>
                            <div class="benefit-card">
                                <span class="material-icons">analytics</span>
                                <h3>B√°o c√°o doanh thu</h3>
                                <p>Theo d√µi doanh thu v√† hi·ªáu su·∫•t b√°n h√†ng theo th·ªùi gian th·ª±c</p>
                            </div>
                            <div class="benefit-card">
                                <span class="material-icons">support</span>
                                <h3>H·ªó tr·ª£ 24/7</h3>
                                <p>ƒê·ªôi ng≈© h·ªó tr·ª£ lu√¥n s·∫µn s√†ng gi√∫p ƒë·ª° b·∫°n</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="requirements-section">
                        <h2>Y√™u c·∫ßu ƒë·ªÉ tr·ªü th√†nh ng∆∞·ªùi b√°n</h2>
                        <ul class="requirements-list">
                            <li>
                                <span class="material-icons">check_circle</span>
                                <span>C√≥ t√†i kho·∫£n HgShop ƒë√£ x√°c minh</span>
                            </li>
                            <li>
                                <span class="material-icons">check_circle</span>
                                <span>Cung c·∫•p th√¥ng tin c√° nh√¢n/ch·ª©ng minh nh√¢n d√¢n</span>
                            </li>
                            <li>
                                <span class="material-icons">check_circle</span>
                                <span>ƒê·ªìng √Ω v·ªõi c√°c ƒëi·ªÅu kho·∫£n b√°n h√†ng c·ªßa HgShop</span>
                            </li>
                            <li>
                                <span class="material-icons">check_circle</span>
                                <span>C√≥ s·∫£n ph·∫©m ƒë·ªÉ b√°n</span>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="application-section">
                        <h2>ƒêƒÉng k√Ω tr·ªü th√†nh ng∆∞·ªùi b√°n</h2>
                        <form id="sellerApplicationForm">
                            <div class="form-group">
                                <label for="storeName">T√™n c·ª≠a h√†ng</label>
                                <input type="text" id="storeName" name="storeName" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="storeDescription">M√¥ t·∫£ c·ª≠a h√†ng</label>
                                <textarea id="storeDescription" name="storeDescription" rows="4" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="businessType">Lo·∫°i h√¨nh kinh doanh</label>
                                <select id="businessType" name="businessType" required>
                                    <option value="">Ch·ªçn lo·∫°i h√¨nh kinh doanh</option>
                                    <option value="individual">C√° nh√¢n</option>
                                    <option value="company">Doanh nghi·ªáp</option>
                                    <option value="cooperative">H·ª£p t√°c x√£</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="idCard">S·ªë CMND/CCCD</label>
                                <input type="text" id="idCard" name="idCard" required>
                            </div>
                            
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="termsAgreement" name="termsAgreement" required>
                                    T√¥i ƒë·ªìng √Ω v·ªõi <a href="seller-terms.html" target="_blank">ƒêi·ªÅu kho·∫£n ng∆∞·ªùi b√°n</a>
                                </label>
                            </div>
                            
                            <button type="submit" class="btn primary">G·ª≠i ƒë∆°n ƒëƒÉng k√Ω</button>
                        </form>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Cart Sidebar -->
    <div id="cartSidebar" class="cart-sidebar hidden">
        <div class="cart-header">
            <h3>Gi·ªè h√†ng</h3>
            <button id="closeCart" class="close-btn">
                <span class="material-icons">close</span>
            </button>
        </div>
        <div id="cartItems" class="cart-items">
            <!-- Cart items will be populated here -->
        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <span>T·ªïng c·ªông:</span>
                <span id="cartTotal">0ƒë</span>
            </div>
            <button id="checkoutBtn" class="btn primary">Thanh to√°n</button>
        </div>
    </div>

    <!-- Overlay -->
    <div id="overlay" class="overlay hidden"></div>

    <!-- About / Footer -->
    <section class="about-section" id="contact">
        <div class="container narrow">
            <h2>Gi·ªõi thi·ªáu v·ªÅ HgShop</h2>
            <p>HgShop l√† n·ªÅn t·∫£ng mua s·∫Øm linh ki·ªán m√°y t√≠nh, laptop v√† ph·ª• ki·ªán c√¥ng ngh·ªá ch·∫•t l∆∞·ª£ng.</p>
            
            <div class="about-content">
                <div class="about-info">
                    <p><strong>Mua b√°n linh ki·ªán m√°y t√≠nh, laptop uy t√≠n ch·∫•t l∆∞·ª£ng</strong></p>
                    <ul>
                        <li>üè† ƒê·ªãa ch·ªâ: 18 Louis VI, Ho√†ng Mai, Ho√†ng VƒÉn Th·ª•, H√† N·ªôi</li>
                        <li>üìû S·ªë ƒëi·ªán tho·∫°i: 0343867095</li>
                        <li>üë§ Th√†nh vi√™n: Nguy·ªÖn Nh·∫≠t Ho√†ng<br>üìß Gmail: nguyennhathoangne@gmail.com</li>
                    </ul>
                </div>
                
                <div class="about-links">
                    <div class="footer-section">
                        <h4>Li√™n k·∫øt</h4>
                        <ul>
                            <li><a href="index.html">Trang ch·ªß</a></li>
                            <li><a href="terms.html">ƒêi·ªÅu kho·∫£n</a></li>
                            <li><a href="privacy.html">B·∫£o m·∫≠t</a></li>
                            <li><a href="contact.html">Li√™n h·ªá</a></li>
                        </ul>
                    </div>
                    
                    <div class="footer-section">
                        <h4>Theo d√µi ch√∫ng t√¥i</h4>
                        <div class="social-links">
                            <a href="https://www.facebook.com/hvoaanng" target="_blank" class="social-link">
                                <span class="material-icons">facebook</span>
                            </a>
                            <a href="https://www.instagram.com/hgne1404" target="_blank" class="social-link">
                                <span class="material-icons">photo_camera</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="copyright">
                <p>¬© 2025 HgShop. T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
            </div>
        </div>
    </section>
    
    <script src="script.js"></script>
    <script src="cart.js"></script>
    <script src="auth.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Avatar menu toggle
        const avatarIcon = document.getElementById('avatarIcon');
        const accountMenu = document.getElementById('accountMenu');
        
        if (avatarIcon && accountMenu) {
            avatarIcon.addEventListener('click', function(e) {
                e.stopPropagation();
                accountMenu.classList.toggle('hidden');
            });
            
            // Close account menu when clicking outside
            document.addEventListener('click', function(e) {
                if (!avatarIcon.contains(e.target) && !accountMenu.contains(e.target)) {
                    accountMenu.classList.add('hidden');
                }
            });
        }
        
        // Notification tooltip toggle
        const notifyBtn = document.getElementById('notifyBtn');
        const notifyTooltip = document.getElementById('notifyTooltip');
        const closeNotify = document.getElementById('closeNotify');
        
        if (notifyBtn && notifyTooltip) {
            notifyBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                notifyTooltip.classList.toggle('hidden');
            });
            
            if (closeNotify) {
                closeNotify.addEventListener('click', function() {
                    notifyTooltip.classList.add('hidden');
                });
            }
            
            // Close notification tooltip when clicking outside
            document.addEventListener('click', function(e) {
                if (!notifyBtn.contains(e.target) && !notifyTooltip.contains(e.target)) {
                    notifyTooltip.classList.add('hidden');
                }
            });
        }
        
        // Cart sidebar toggle
        const cartBtn = document.getElementById('cartBtn');
        const cartSidebar = document.getElementById('cartSidebar');
        const closeCart = document.getElementById('closeCart');
        const overlay = document.getElementById('overlay');
        const checkoutBtn = document.getElementById('checkoutBtn');
        
        if (cartBtn && cartSidebar && overlay) {
            cartBtn.addEventListener('click', function() {
                cartSidebar.classList.remove('hidden');
                overlay.classList.remove('hidden');
                // Render cart items when opening
                if (typeof renderCartItems === 'function') {
                    renderCartItems();
                }
            });
            
            closeCart.addEventListener('click', function() {
                cartSidebar.classList.add('hidden');
                overlay.classList.add('hidden');
            });
            
            overlay.addEventListener('click', function() {
                cartSidebar.classList.add('hidden');
                overlay.classList.add('hidden');
            });
            
            if (checkoutBtn) {
                checkoutBtn.addEventListener('click', function() {
                    window.location.href = 'checkout.html';
                });
            }
        }
        
        // Seller application form submission
        const sellerApplicationForm = document.getElementById('sellerApplicationForm');
        if (sellerApplicationForm) {
            sellerApplicationForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const termsAgreement = document.getElementById('termsAgreement');
                if (!termsAgreement.checked) {
                    alert('Vui l√≤ng ƒë·ªìng √Ω v·ªõi ƒêi·ªÅu kho·∫£n ng∆∞·ªùi b√°n.');
                    return;
                }
                
                // Get current user
                const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
                if (!currentUser) {
                    alert('B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ th·ª±c hi·ªán thao t√°c n√†y.');
                    window.location.href = 'login.html';
                    return;
                }
                
                try {
                    // Update user role in Firebase
                    if (window.firebaseDatabase) {
                        const { ref, update } = await import("https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js");
                        
                        // Update user role to 'seller'
                        const userRef = ref(window.firebaseDatabase, 'users/' + currentUser.uid);
                        await update(userRef, {
                            role: 'seller'
                        });
                        
                        // Update localStorage
                        const updatedUser = {
                            ...currentUser,
                            role: 'seller'
                        };
                        localStorage.setItem('currentUser', JSON.stringify(updatedUser));
                        
                        // Update seller menu
                        if (typeof updateSellerMenu === 'function') {
                            updateSellerMenu();
                        }
                        
                        alert('Ch√∫c m·ª´ng! B·∫°n ƒë√£ tr·ªü th√†nh ng∆∞·ªùi b√°n h√†ng. B·∫°n c√≥ th·ªÉ b·∫Øt ƒë·∫ßu b√°n s·∫£n ph·∫©m ngay b√¢y gi·ªù.');
                        window.location.href = 'seller.html';
                    } else {
                        throw new Error('Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn c∆° s·ªü d·ªØ li·ªáu.');
                    }
                } catch (error) {
                    console.error('Error updating user role:', error);
                    alert('C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t vai tr√≤ ng∆∞·ªùi d√πng: ' + error.message);
                }
            });
        }
        
        // Logout functionality
        const logoutBtn = document.getElementById('logoutBtn');
        
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function() {
                if (typeof window.logout === 'function') {
                    window.logout();
                } else {
                    // Fallback logout
                    localStorage.removeItem('currentUser');
                    window.location.href = 'login.html';
                }
            });
        }
    });
    </script>
</body>
</html>