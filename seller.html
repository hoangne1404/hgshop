<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>K√™nh ng∆∞·ªùi b√°n - HgShop</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Firebase -->
  <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
      import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
      import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";
      import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-storage.js";

      // Import Firebase config
      import "./firebase-config.js";

      // Initialize Firebase
      const app = initializeApp(window.firebaseConfig);
      const auth = getAuth(app);
      const database = getDatabase(app);
      const storage = getStorage(app);

      // Make Firebase objects globally available
      window.firebaseApp = app;
      window.firebaseAuth = auth;
      window.firebaseDatabase = database;
      window.firebaseStorage = storage;

      // Authentication state listener
      onAuthStateChanged(auth, (user) => {
          if (user) {
              // Load user data
              const userRef = ref(database, 'users/' + user.uid);
              onValue(userRef, (snapshot) => {
                  const userData = snapshot.val();
                  if (userData) {
                      // Save user data to localStorage
                      localStorage.setItem('currentUser', JSON.stringify({
                          uid: user.uid,
                          email: user.email,
                          ...userData
                      }));
                  }
              });
          } else {
              // Redirect to login if not authenticated
              window.location.href = 'login.html';
          }
      });
  </script>
    
  <script defer src="auth.js"></script>
  <script defer src="seller.js"></script>
  <script defer src="cloudinary-config.js"></script>
  <script defer src="cloudinary.js"></script>
  <script defer src="cart.js"></script>
</head>
<body>
    <!-- Notification Tooltip -->
    <div id="notifyTooltip" class="tooltip hidden">
        <div class="tooltip-header">
            <h3>Th√¥ng b√°o</h3>
            <button id="closeNotify" class="close-btn">
                <span class="material-icons">close</span>
            </button>
        </div>
        <div id="notificationList" class="notification-list">
            <p>Kh√¥ng c√≥ th√¥ng b√°o m·ªõi</p>
        </div>
    </div>
    
    <!-- Header -->
    <header class="navbar">
        <div class="logo">
            <a href="index.html" style="color: white; text-decoration: none;">HgShop</a>
        </div>
        
        <nav class="nav-links">
            <a href="index.html">Trang ch·ªß</a>
            <a href="products.html">S·∫£n ph·∫©m</a>
            <a href="contact.html">Li√™n h·ªá</a>
        </nav>
        
        <div class="topbar-icons">
            <button id="notifyBtn" class="icon-btn">
                <span class="material-icons">notifications</span>
                <span id="notificationBadge" class="badge">0</span>
            </button>
            
            <button id="cartBtn" class="icon-btn">
                <span class="material-icons cart-icon">shopping_cart</span>
                <span id="cartCount" class="badge">0</span>
            </button>
            
            <div class="avatar-wrapper">
                <img id="avatarIcon" src="images/default-avatar.png" alt="Avatar" class="avatar-icon">
            </div>
        </div>
    </header>

    <!-- Account Menu -->
    <div id="accountMenu" class="account-menu hidden">
        <a href="profile.html" class="menu-item">
            <span class="material-icons">person</span>
            T√†i kho·∫£n c·ªßa t√¥i
        </a>
        <a href="orders.html" class="menu-item">
            <span class="material-icons">receipt</span>
            ƒê∆°n h√†ng c·ªßa b·∫°n
        </a>
        <a id="becomeSellerLink" href="become-seller.html" class="menu-item">
            <span class="material-icons">store</span>
            <span id="sellerMenuText">Tr·ªü th√†nh ng∆∞·ªùi b√°n</span>
        </a>
        <hr>
        <button id="logoutBtn" class="menu-item logout">
            <span class="material-icons">logout</span>
            <span>ƒêƒÉng xu·∫•t</span>
        </button>
    </div>

  <main class="container">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <h2>K√™nh ng∆∞·ªùi b√°n</h2>
      <div class="card" style="padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
        <div style="font-size: 14px;">T·ªïng doanh thu</div>
        <div id="monthlyRevenue" style="font-size: 24px; font-weight: bold;">ƒêang t·∫£i...</div>
      </div>
    </div>
    
    <div class="card">
      <h3>Th√¥ng tin c·ª≠a h√†ng</h3>
      <div class="form-group">
        <label for="storeName">T√™n c·ª≠a h√†ng</label>
        <input type="text" id="storeName" class="form-control" placeholder="T√™n c·ª≠a h√†ng c·ªßa b·∫°n">
      </div>
      
      <div class="form-group">
        <label for="storeDescription">M√¥ t·∫£ c·ª≠a h√†ng</label>
        <textarea id="storeDescription" class="form-control" placeholder="M√¥ t·∫£ v·ªÅ c·ª≠a h√†ng c·ªßa b·∫°n" rows="3"></textarea>
      </div>
      
      <button id="saveStoreInfo" class="btn primary">L∆∞u th√¥ng tin</button>
    </div>
    
    <div class="card">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h3>Th√™m s·∫£n ph·∫©m m·ªõi</h3>
        <button id="addProductModalBtn" class="btn primary">+ Th√™m s·∫£n ph·∫©m</button>
      </div>
      
      <div id="productForm" style="display: none;">
        <div class="form-group">
          <label for="productName">T√™n s·∫£n ph·∫©m</label>
          <input type="text" id="productName" class="form-control" placeholder="T√™n s·∫£n ph·∫©m">
        </div>
        
        <div class="form-group">
          <label for="productDescription">M√¥ t·∫£ s·∫£n ph·∫©m</label>
          <textarea id="productDescription" class="form-control" placeholder="M√¥ t·∫£ s·∫£n ph·∫©m" rows="3"></textarea>
        </div>
        
        <div class="form-group">
          <label for="productSpecifications">Th√¥ng s·ªë k·ªπ thu·∫≠t (m·ªói d√≤ng m·ªôt th√¥ng s·ªë)</label>
          <textarea id="productSpecifications" class="form-control" placeholder="V√≠ d·ª•:&#10;CPU: Intel Core i7&#10;RAM: 16GB DDR4&#10;·ªî c·ª©ng: 512GB SSD" rows="4"></textarea>
        </div>
        
        <div class="form-row">
          <div class="form-group" style="flex:1">
            <label for="productPrice">Gi√° s·∫£n ph·∫©m (ƒë)</label>
            <input type="number" id="productPrice" class="form-control" placeholder="Gi√° s·∫£n ph·∫©m">
          </div>
          <div class="form-group" style="flex:1">
            <label for="productQuantity">S·ªë l∆∞·ª£ng</label>
            <input type="number" id="productQuantity" class="form-control" placeholder="S·ªë l∆∞·ª£ng" value="100">
          </div>
        </div>
        
        <div class="form-group">
          <label for="productCategory">Danh m·ª•c</label>
          <select id="productCategory" class="form-control">
            <option value="monitor">M√†n h√¨nh</option>
            <option value="laptop">Laptop & Linh ki·ªán</option>
            <option value="accessories">Ph·ª• ki·ªán</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="productImage">·∫¢nh s·∫£n ph·∫©m</label>
          <input type="file" id="productImage" class="form-control" accept="image/*">
          <div id="imagePreview" style="margin-top:10px"></div>
        </div>
      
      <button id="addProduct" class="btn primary" style="margin-top:10px">Th√™m s·∫£n ph·∫©m</button>
      </div>
    </div>
    
    <div class="card">
      <h3>S·∫£n ph·∫©m c·ªßa t√¥i</h3>
      <div id="myProducts" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:20px">
        <!-- Products will be loaded here by JavaScript -->
      </div>
    </div>
    
    <div class="card">
      <h3>ƒê∆°n h√†ng g·∫ßn ƒë√¢y</h3>
      <div id="recentOrders">
        <!-- Orders will be loaded here by JavaScript -->
      </div>
    </div>
  </main>

  <!-- Cart Sidebar -->
  <div id="cartSidebar" class="cart-sidebar hidden">
      <div class="cart-header">
          <h3>Gi·ªè h√†ng</h3>
          <button id="closeCart" class="close-btn">
              <span class="material-icons">close</span>
          </button>
      </div>
      <div id="cartItems" class="cart-items">
          <!-- Cart items will be populated here -->
      </div>
      <div class="cart-footer">
          <div class="cart-total">
              <span>T·ªïng c·ªông:</span>
              <span id="cartTotal">0ƒë</span>
          </div>
          <button id="checkoutBtn" class="btn primary">Thanh to√°n</button>
      </div>
  </div>

  <!-- Overlay -->
  <div id="overlay" class="overlay hidden"></div>

  <!-- About / Footer -->
  <section class="about-section" id="contact">
      <div class="container narrow">
          <h2>Gi·ªõi thi·ªáu v·ªÅ HgShop</h2>
          <p>HgShop l√† n·ªÅn t·∫£ng mua s·∫Øm linh ki·ªán m√°y t√≠nh, laptop v√† ph·ª• ki·ªán c√¥ng ngh·ªá ch·∫•t l∆∞·ª£ng.</p>
          
          <div class="about-content">
              <div class="about-info">
                  <p><strong>Mua b√°n linh ki·ªán m√°y t√≠nh, laptop uy t√≠n ch·∫•t l∆∞·ª£ng</strong></p>
                  <ul>
                      <li>üè† ƒê·ªãa ch·ªâ: 18 Louis VI, Ho√†ng Mai, Ho√†ng VƒÉn Th·ª•, H√† N·ªôi</li>
                      <li>üìû S·ªë ƒëi·ªán tho·∫°i: 0343867095</li>
                      <li>üë§ Th√†nh vi√™n: Nguy·ªÖn Nh·∫≠t Ho√†ng<br>üìß Gmail: nguyennhathoangne@gmail.com</li>
                  </ul>
              </div>
              
              <div class="about-links">
                  <div class="footer-section">
                      <h4>Li√™n k·∫øt</h4>
                      <ul>
                          <li><a href="index.html">Trang ch·ªß</a></li>
                          <li><a href="terms.html">ƒêi·ªÅu kho·∫£n</a></li>
                          <li><a href="privacy.html">B·∫£o m·∫≠t</a></li>
                          <li><a href="contact.html">Li√™n h·ªá</a></li>
                      </ul>
                  </div>
                  
                  <div class="footer-section">
                      <h4>Theo d√µi ch√∫ng t√¥i</h4>
                      <div class="social-links">
                          <a href="https://www.facebook.com/hvoaanng" target="_blank" class="social-link">
                              <span class="material-icons">facebook</span>
                          </a>
                          <a href="https://www.instagram.com/hgne1404" target="_blank" class="social-link">
                              <span class="material-icons">photo_camera</span>
                          </a>
                      </div>
                  </div>
              </div>
          </div>
          
          <div class="copyright">
              <p>¬© 2025 HgShop. T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
          </div>
      </div>
  </section>

  <script>
    // Initialize image upload functionality
    document.addEventListener('DOMContentLoaded', function() {
      // Call updateUserAvatar and updateSellerMenu functions from script.js
      if (typeof updateUserAvatar === 'function') {
        updateUserAvatar();
      }
      if (typeof updateSellerMenu === 'function') {
        updateSellerMenu();
      }
      
      // Initialize seller functionality
      if (typeof initSeller === 'function') {
        initSeller();
      }
      
      // Handle image preview
      const productImage = document.getElementById('productImage');
      const imagePreview = document.getElementById('imagePreview');
      
      if (productImage) {
        productImage.addEventListener('change', function(e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
              imagePreview.innerHTML = `<img src="${e.target.result}" style="max-width:200px;max-height:200px;border-radius:8px">`;
            };
            reader.readAsDataURL(file);
          }
        });
      }
      
      // Handle add product button - now includes Cloudinary upload
      const addProductBtn = document.getElementById('addProduct');
      if (addProductBtn) {
        addProductBtn.addEventListener('click', async function(e) {
          e.preventDefault();
          const cur = JSON.parse(localStorage.getItem('currentUser') || 'null');
          if (cur) {
            // Call the function directly if available
            if (typeof addNewProduct === 'function') {
              await addNewProduct(cur);
            } else {
              // Fallback to event dispatching
              window.dispatchEvent(new CustomEvent('addProduct', { detail: cur }));
            }
          }
        });
      }
      
      // Toggle product form
      const addProductModalBtn = document.getElementById('addProductModalBtn');
      const productForm = document.getElementById('productForm');
      
      if (addProductModalBtn && productForm) {
        addProductModalBtn.addEventListener('click', function() {
          productForm.style.display = productForm.style.display === 'none' ? 'block' : 'none';
        });
      }
      
      // Handle save store info
      const saveStoreInfoBtn = document.getElementById('saveStoreInfo');
      
      if (saveStoreInfoBtn) {
        saveStoreInfoBtn.addEventListener('click', function() {
          const storeName = document.getElementById('storeName').value;
          const storeDescription = document.getElementById('storeDescription').value;
          
          // In a real app, you would save this to Firebase
          alert('Th√¥ng tin c·ª≠a h√†ng ƒë√£ ƒë∆∞·ª£c l∆∞u!');
        });
      }
      
      // Add avatar menu toggle functionality
      const avatarIcon = document.getElementById('avatarIcon');
      const accountMenu = document.getElementById('accountMenu');
      
      if (avatarIcon && accountMenu) {
        avatarIcon.addEventListener('click', function(e) {
          e.stopPropagation();
          accountMenu.classList.toggle('hidden');
        });
        
        // Close account menu when clicking outside
        document.addEventListener('click', function(e) {
          if (!avatarIcon.contains(e.target) && !accountMenu.contains(e.target)) {
            accountMenu.classList.add('hidden');
          }
        });
      }
      
      // Notification tooltip toggle
      const notifyBtn = document.getElementById('notifyBtn');
      const notifyTooltip = document.getElementById('notifyTooltip');
      const closeNotify = document.getElementById('closeNotify');
      
      if (notifyBtn && notifyTooltip) {
        notifyBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          notifyTooltip.classList.toggle('hidden');
        });
        
        if (closeNotify) {
          closeNotify.addEventListener('click', function() {
            notifyTooltip.classList.add('hidden');
          });
        }
        
        // Close notification tooltip when clicking outside
        document.addEventListener('click', function(e) {
          if (!notifyBtn.contains(e.target) && !notifyTooltip.contains(e.target)) {
            notifyTooltip.classList.add('hidden');
          }
        });
      }
      
      // Cart sidebar toggle
      const cartBtn = document.getElementById('cartBtn');
      const cartSidebar = document.getElementById('cartSidebar');
      const closeCart = document.getElementById('closeCart');
      const overlay = document.getElementById('overlay');
      const checkoutBtn = document.getElementById('checkoutBtn');
      
      if (cartBtn && cartSidebar && overlay) {
        cartBtn.addEventListener('click', function() {
          cartSidebar.classList.remove('hidden');
          overlay.classList.remove('hidden');
          // Render cart items when opening
          if (typeof renderCartItems === 'function') {
            renderCartItems();
          }
        });
        
        closeCart.addEventListener('click', function() {
          cartSidebar.classList.add('hidden');
          overlay.classList.add('hidden');
        });
        
        overlay.addEventListener('click', function() {
          cartSidebar.classList.add('hidden');
          overlay.classList.add('hidden');
        });
        
        if (checkoutBtn) {
          checkoutBtn.addEventListener('click', function() {
            window.location.href = 'checkout.html';
          });
        }
      }
      
      // Logout functionality
      const logoutBtn = document.getElementById('logoutBtn');
      
      if (logoutBtn) {
        logoutBtn.addEventListener('click', function() {
          if (typeof window.logout === 'function') {
            window.logout();
          } else {
            // Fallback logout
            localStorage.removeItem('currentUser');
            window.location.href = 'login.html';
          }
        });
      }
    });
  </script>
</body>
</html>