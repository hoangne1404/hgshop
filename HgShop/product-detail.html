<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chi ti·∫øt s·∫£n ph·∫©m - HgShop</title>
  <link rel="stylesheet" href="style.css" />
  <script defer src="auth.js"></script>
  <script defer src="script.js"></script>
  <script defer src="chatbot.js"></script>
</head>
<body>
  <!-- HEADER -->
  <header class="topbar">
    <div class="brand">
      <a href="index.html" style="display: flex; align-items: center; gap: 12px; text-decoration: none; color: inherit;">
        <img id="siteLogoImg" src="images/logo.png" alt="HgShop" class="site-logo" onerror="this.style.display='none'"/>
        <div class="logo-text-wrap">
          <div class="logo-text">
            <span class="logo-h">H</span><span class="logo-g">g</span><span class="logo-shop">Shop</span>
          </div>
          <div class="logo-sub">Linh ki·ªán & Laptop</div>
        </div>
      </a>
    </div>

    <div class="center-actions">
      <div class="search-container">
        <div class="search">
          <input id="searchInput" placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m..." />
          <button id="searchBtn" class="search-btn">üîç</button>
        </div>
        <div id="searchResults" class="search-results hidden"></div>
      </div>
    </div>

    <div class="right-actions">
      <button id="notifyBtn" class="icon-btn">üîî<span id="notifyBadge" class="badge hidden">0</span></button>
      <button id="avatarBtn" class="avatar-btn">
        <img id="avatarIcon" src="images/default-avatar.png" class="avatar" alt="avatar"/>
      </button>
      <button id="cartBtn" class="cart-btn">üõí <span id="cartCount">0</span></button>
    </div>
  </header>

  <!-- Account menu (toggle) -->
  <div id="accountMenu" class="dropdown hidden">
    <a href="account.html">T√†i kho·∫£n c·ªßa t√¥i</a>
    <a href="account.html#orders">ƒê∆°n h√†ng c·ªßa t√¥i</a>
    <a href="account.html#settings">C√†i ƒë·∫∑t t√†i kho·∫£n</a>
    <button id="logoutBtn" class="link-btn">ƒêƒÉng xu·∫•t</button>
  </div>

  <main class="container narrow">
    <div id="productDetail" class="card">
      <!-- N·ªôi dung s·∫Ω ƒë∆∞·ª£c ƒëi·ªÅn b·∫±ng JavaScript -->
    </div>
  </main>

  <footer class="footer">
    <div>¬© 2025 HgShop</div>
    <div>contact@hgshop.vn | 0343867095</div>
  </footer>

  <!-- Cart sidebar -->
  <aside id="cartSidebar" class="cart-sidebar hidden">
    <div class="cart-header">
      <h3>Gi·ªè h√†ng</h3>
      <button id="closeCart" class="icon-btn">‚úñ</button>
    </div>
    <div id="cartItems" class="cart-items"></div>
    <div class="cart-footer">
      <div>T·ªïng: <strong id="cartTotal">0ƒë</strong></div>
      <div style="display:flex;gap:8px">
        <button id="toCheckout" class="primary">Thanh to√°n</button>
        <a href="account.html#orders" class="secondary">ƒê∆°n h√†ng</a>
      </div>
    </div>
  </aside>
  <div id="overlay" class="overlay hidden"></div>

  <!-- Chatbot Widget -->
  <div id="chatbotWidget" class="chatbot-widget">
    <div id="chatbotToggle" class="chatbot-toggle">üí¨</div>
    <div id="chatbotWindow" class="chatbot-window hidden">
      <div class="chatbot-header">
        <h4>H·ªó tr·ª£ kh√°ch h√†ng</h4>
        <button id="closeChatbot" class="icon-btn">‚úñ</button>
      </div>
      <div id="chatbotMessages" class="chatbot-messages">
        <div class="message bot">
          <div class="message-content">Xin ch√†o! T√¥i c√≥ th·ªÉ gi√∫p g√¨ cho b·∫°n? H√£y h·ªèi t√¥i v·ªÅ s·∫£n ph·∫©m laptop, m√†n h√¨nh ho·∫∑c linh ki·ªán m√°y t√≠nh.</div>
        </div>
      </div>
      <div class="chatbot-input">
        <input id="chatbotInput" placeholder="Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n..." />
        <button id="sendChatbotMsg">G·ª≠i</button>
      </div>
    </div>
  </div>

  <script>
    // ƒê·ª£i cho DOM load ho√†n to√†n v√† script.js ƒë√£ ch·∫°y
    document.addEventListener('DOMContentLoaded', function() {
      // L·∫•y ID s·∫£n ph·∫©m t·ª´ URL
      const urlParams = new URLSearchParams(window.location.search);
      const productId = parseInt(urlParams.get('id'));

      // Ki·ªÉm tra n·∫øu window.PRODUCTS ƒë√£ ƒë∆∞·ª£c t·∫£i
      if (typeof window.PRODUCTS === 'undefined') {
        // N·∫øu ch∆∞a, th·ª≠ l·∫°i sau 100ms
        setTimeout(loadProductDetail, 100);
      } else {
        loadProductDetail();
      }

      function loadProductDetail() {
        // T√¨m s·∫£n ph·∫©m trong danh s√°ch
        const product = window.PRODUCTS ? window.PRODUCTS.find(p => p.id === productId) : null;
        const productDetail = document.getElementById('productDetail');

        if (product) {
          productDetail.innerHTML = `
            <div style="display:flex;gap:24px;flex-wrap:wrap;margin-bottom:24px">
              <div style="flex:1;min-width:300px">
                <img src="images/sanpham/${product.image}" alt="${product.name}" style="width:100%;max-height:400px;object-fit:contain;border-radius:12px" onerror="this.src='images/default-product.png'"/>
              </div>
              <div style="flex:2;min-width:300px">
                <h1>${product.name}</h1>
                <div class="price" style="font-size:24px;margin:12px 0">${window.fmt ? window.fmt(product.price) : product.price.toLocaleString('vi-VN') + 'ƒë'}</div>
                <div class="rating" style="font-size:18px;color:#ffa500;margin-bottom:12px">
                  ${'‚òÖ'.repeat(Math.floor(product.rating))}${product.rating % 1 >= 0.5 ? '¬Ω' : ''}${'‚òÜ'.repeat(5-Math.ceil(product.rating))} (${product.reviews ? product.reviews.length : 0} ƒë√°nh gi√°)
                </div>
                <p style="line-height:1.6">${product.description}</p>
                <div style="margin:16px 0">
                  <button class="btn primary" onclick="addToCart(${product.id})" style="padding:12px 24px;font-size:16px">Th√™m v√†o gi·ªè h√†ng</button>
                </div>
                <div style="margin-bottom:16px">
                  <h3>Th√¥ng s·ªë k·ªπ thu·∫≠t</h3>
                  <ul style="padding-left:20px">
                    ${product.specifications.map(spec => `<li style="margin-bottom:8px">${spec}</li>`).join('')}
                  </ul>
                </div>
                <div>
                  <h3>Nh√† cung c·∫•p</h3>
                  <p style="font-weight:600">${product.supplier}</p>
                </div>
              </div>
            </div>

            <div style="margin-top:32px">
              <h2>ƒê√°nh gi√° s·∫£n ph·∫©m</h2>
              ${product.reviews && product.reviews.length > 0 ? product.reviews.map(review => `
                <div style="padding:16px;border-bottom:1px solid #e5e7eb">
                  <div style="display:flex;justify-content:space-between;align-items:center">
                    <strong>${review.user}</strong>
                    <span class="rating" style="color:#ffa500">
                      ${'‚òÖ'.repeat(review.rating)}${'‚òÜ'.repeat(5-review.rating)}
                    </span>
                  </div>
                  <p style="margin:8px 0">${review.comment}</p>
                  <small style="color:#6b7280">${review.date}</small>
                </div>
              `).join('') : '<p>Ch∆∞a c√≥ ƒë√°nh gi√° n√†o.</p>'}
            </div>
          `;
        } else {
          productDetail.innerHTML = '<p>S·∫£n ph·∫©m kh√¥ng t·ªìn t·∫°i. <a href="index.html">Quay l·∫°i trang ch·ªß</a></p>';
        }
      }
    });
  </script>
</body>
</html>